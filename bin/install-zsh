#!/usr/bin/env bash
set -euo pipefail

echo -e "\n> Begin to execute install-zsh."

cd /tmp

echo "> Installing zsh ..."

if [ $(uname) == "Linux" ] && [ ! -f /usr/bin/zsh ]; then
    sudo apt install zsh
elif [ $(uname) == "Darwin" ] && [ ! -f /bin/zsh ]; then
    brew install zsh
fi

rc=~/.gclrc
if [ ! -d "$rc" ]; then
    echo "> Cloning my private dotfiles..."
    git clone git@code.aliyun.com:wyu/dotdat.git $rc

    chmod +x $rc/bin/*

fi

if [ ! -d ~/.oh-my-zsh ]; then
    echo "> Installing oh-my-zsh..."
    curl -fsSL https://raw.github.com/ohmyzsh/ohmyzsh/master/tools/install.sh | bash
fi

echo "> Cover the default .zshrc"
cp $rc/.zshrc ~/.zshrc

echo "> source it !"
source ~/.zshrc

GETENT="/usr/local/bin/getent"
echo "> getent command"
if [ ! -f "$GETENT" ]; then
    cp "$rc/bin/getent" "$GETENT"
    chmod +x "$GETENT"
else
    echo "> getent existed."
fi

echo -e "> ------ install-zsh DONE ------\n"
