#+TITLE:  My Hammerspoon Confiration
#+DATE: <2021-08-12 15:47:14>
#+EMAIL: Lee ZhiCheng<gccll.love@gmail.com>
#+CATEGORIES[]: macos
#+LANGUAGE: zh-cn
#+LANGUAGE: zh-cn
#+STARTUP: indent
#+auto_tangle: t

:CONFIG:
#+property: header-args:lua :tangle init.lua
#+property: header-args :mkdirp yes :comments no
#+startup: indent

#+begin_src lua :exports none
-- DO NOT EDIT THIS FILE DIRECTLY
-- This is a file generated from a literate programing source file located at
-- https://github.com/zzamboni/dot-hammerspoon/blob/master/init.org.
-- You should make any changes there and regenerate it from Emacs org-mode using C-c C-v t
#+end_src
:END:


* Keybindings
hyper key: =Command + Option + Control=

| Key   | Action     |
|-------+------------|
| =Alt r= | open modal |

Launch Apps(=Ctrl+Alt=):
| Key | App      |
|-----+----------|
| c   | Calendar |
| d   | Dash     |
| e   | Emacs    |
| f   | Finder   |
| i   | iTerms   |
| n   | Notes    |
| w   | WeChat   |

Window management:

| Key     | Action                 |
|---------+------------------------|
| =<-=      | Move Left              |
| =->=      | Move Right             |
| =↑=       | Move up                |
| =↓=       | Move Down              |
| =i=       | Decrease height        |
| =k=       | Increase height        |
| =j=       | Decrease width         |
| =l=       | Increase width         |
| =2=       | Set 2x2 grid           |
| =3=       | Set 3x3 grid           |
| =4=       | Set 4x4 grid           |
| =9=       | Lock screen            |
| ~/~       | To next screen         |
| =,=       | Snap to grid           |
| =(space)= | Maximize window        |
| ~.~       | Minimize window        |
| =g=       | 6x4grid                |
| =t=       | org capture            |
| =f12=     | toggle screen rotation |
|         |                        |
|         |                        |


* start

#+begin_src lua
shift_hyper = {"cmd","alt","ctrl","shift"}
ctrl_cmd    = {"cmd","ctrl"}
mash        = {"⌘", "⌥", "⌃"}
hyper       = mash

col = hs.drawing.color.x11

local log = hs.logger.new('init.lua', 'debug')

-- Use Control+` to reload Hammerspoon config
hs.hotkey.bind(mash, 'r', nil, function()
  hs.reload()
end)
#+end_src
* window

#+begin_src lua
hs.grid.setGrid('3x3')
hs.grid.setMargins("0,0")
hs.window.animationDuration = 0

function getWin()
  return hs.window.focusedWindow()
end

--- arrows: move window
hs.hotkey.bind(mash, "left", function() hs.grid.pushWindowLeft() end)
hs.hotkey.bind(mash, "right", function() hs.grid.pushWindowRight() end)
hs.hotkey.bind(mash, "up", function() hs.grid.pushWindowUp() end)
hs.hotkey.bind(mash, "down", function() hs.grid.pushWindowDown() end)

--- ikjl: resize window
hs.hotkey.bind(mash, "k", function() hs.grid.resizeWindowShorter() end)
hs.hotkey.bind(mash, "j", function() hs.grid.resizeWindowTaller() end)
hs.hotkey.bind(mash, "h", function() hs.grid.resizeWindowThinner() end)
hs.hotkey.bind(mash, "l", function() hs.grid.resizeWindowWider() end)

--- 234: resize grid
hs.hotkey.bind(mash, "2", function() hs.grid.setGrid('2x2'); hs.alert.show('Grid set to 2x2'); end)
hs.hotkey.bind(mash, "3", function() hs.grid.setGrid('3x3'); hs.alert.show('Grid set to 3x3'); end)
hs.hotkey.bind(mash, "4", function() hs.grid.setGrid('4x4'); hs.alert.show('Grid set to 4x4'); end)

--- /: move window to next screen
hs.hotkey.bind(mash, "/", function() local win = getWin(); win:moveToScreen(win:screen():next()) end)

--- ,: snap window to grid
hs.hotkey.bind(mash, ",", function() hs.grid.snap(getWin()) end)

--- space: maximize window
hs.hotkey.bind(mash, "space", function() hs.grid.maximizeWindow() end)

--- .: minimize window
hs.hotkey.bind(mash, ".", function() hs.grid.set(getWin(), '0,0 1x1'); end)

--- a: lock screen
hs.hotkey.bind(mash, "9", function() hs.caffeinate.lockScreen(); end)

--- .: show sheet
hs.hotkey.bind(mash, "0", function() hs.alert.show("Hyper: Command + Option + Control \
\
up(↑) down(↓) left(←) right(→) \
\
grid(g,234) next screen(/) max(<space>) min(.)\
\
capture(t)\
"); end)
#+end_src

* org-capture

#+begin_src lua
org_capture_path = os.getenv("HOME").."/.hammerspoon/files/org-capture.lua"
script_file = io.open(org_capture_path, "w")
script_file:write([[local win = hs.window.frontmostWindow()
local o,s,t,r = hs.execute("~/.emacs.d/bin/org-capture", true)
if not s then
  print("Error when running org-capture: "..o.."\n")
end
win:focus()
]])
script_file:close()

hs.hotkey.bindSpec({mash, "t"},
  function ()
    hs.task.new("/bin/bash", nil, { "-l", "-c", "/usr/local/bin/hs "..org_capture_path }):start()
  end
)
#+end_src
* ModalMgr
** Spoon Management

SpoonInstall: spoon 管理器，需要手动安装。

#+begin_src lua
hs.loadSpoon("SpoonInstall")
hs.loadSpoon("ModalMgr")
#+end_src

同步通知：

#+begin_src lua
spoon.SpoonInstall.use_syncinstall = true
#+end_src

This is just a shortcut to make the declarations below look more readable, i.e.
=Install:andUse= instead of =spoon.SpoonInstall:andUse=.

#+begin_src lua
Install=spoon.SpoonInstall
#+end_src
** start

#+begin_src lua
----------------------------------------------------------------------------------------------------
-- Then we create/register all kinds of modal keybindings environments.
----------------------------------------------------------------------------------------------------
-- Register windowHints (Register a keybinding which is NOT modal environment with modal supervisor)
hswhints_keys = hswhints_keys or {"alt", "tab"}
if string.len(hswhints_keys[2]) > 0 then
  spoon.ModalMgr.supervisor:bind(hswhints_keys[1], hswhints_keys[2], 'Show Window Hints', function()
                                   spoon.ModalMgr:deactivateAll()
                                   hs.hints.windowHints()
  end)
end

local cmodal

#+end_src

** app
#+begin_src lua
-- Ctrl + Alt
Install:andUse("AppLauncher", {
  hotkeys = {
    c = "Calendar",
    d = "Dash",
    e = "Emacs",
    f = "Finder",
    i = "iTerm",
    n = "Notes",
    w = "WeChat"
  }
})
#+end_src
** [[http://www.hammerspoon.org/Spoons/WinWin.html][WinWin]]

#+begin_src lua
----------------------------------------------------------------------------------------------------
-- resizeM modal environment
Install:andUse("WinWin", {
                 fn = function (s)
                   spoon.ModalMgr:new("resizeM")
                   cmodal = spoon.ModalMgr.modal_list["resizeM"]
                   cmodal:bind('', 'escape', 'Deactivate resizeM', function() spoon.ModalMgr:deactivate({"resizeM"}) end)
                   cmodal:bind('', 'Q', 'Deactivate resizeM', function() spoon.ModalMgr:deactivate({"resizeM"}) end)
                   cmodal:bind('', 'tab', 'Toggle Cheatsheet', function() spoon.ModalMgr:toggleCheatsheet() end)
                   -------------------------------- Movement --------------------------------
                   cmodal:bind('', 'A', 'Move Leftward', function() s:stepMove("left") end, nil, function() sj:stepMove("left") end)
                   cmodal:bind('', 'D', 'Move Rightward', function() s:stepMove("right") end, nil, function() s:stepMove("right") end)
                   cmodal:bind('', 'W', 'Move Upward', function() s:stepMove("up") end, nil, function() s:stepMove("up") end)
                   cmodal:bind('', 'S', 'Move Downward', function() s:stepMove("down") end, nil, function() s:stepMove("down") end)
                   cmodal:bind('shift', 'H', 'Move Leftward', function() s:stepResize("left") end, nil, function() s:stepResize("left") end)
                   cmodal:bind('shift', 'L', 'Move Rightward', function() s:stepResize("right") end, nil, function() s:stepResize("right") end)
                   cmodal:bind('shift', 'K', 'Move Upward', function() s:stepResize("up") end, nil, function() s:stepResize("up") end)
                   cmodal:bind('shift', 'J', 'Move Downward', function() s:stepResize("down") end, nil, function() s:stepResize("down") end)
                   -------------------------------- Half Split --------------------------------
                   cmodal:bind('', 'H', 'Lefthalf of Screen', function() s:moveAndResize("halfleft") end)
                   cmodal:bind('', 'L', 'Righthalf of Screen', function() s:moveAndResize("halfright") end)
                   cmodal:bind('', 'K', 'Uphalf of Screen', function() s:moveAndResize("halfup") end)
                   cmodal:bind('', 'J', 'Downhalf of Screen', function() s:moveAndResize("halfdown") end)
                   cmodal:bind('', 'F', 'Fullscreen', function() s:moveAndResize("fullscreen") end)
                   cmodal:bind('', 'C', 'Center Window', function() s:moveAndResize("center") end)
                   cmodal:bind('', 'M', 'Maximize Window', function() s:moveAndResize("maximize") end)
                   cmodal:bind('shift', 'M', 'Maximize Window', function() s:moveAndResize("minimize") end)
                   cmodal:bind('ctrl', 'H', 'NorthWest Corner', function() s:moveAndResize("cornerNW") end)
                   cmodal:bind('ctrl', 'L', 'NorthEast Corner', function() s:moveAndResize("cornerNE") end)
                   cmodal:bind('ctrl', 'J', 'SouthWest Corner', function() s:moveAndResize("cornerSW") end)
                   cmodal:bind('ctrl', 'K', 'SouthEast Corner', function() s:moveAndResize("cornerSE") end)
                   cmodal:bind('', '=', 'Stretch Outward', function() s:moveAndResize("expand") end, nil, function() s:moveAndResize("expand") end)
                   cmodal:bind('', '-', 'Shrink Inward', function() s:moveAndResize("shrink") end, nil, function() s:moveAndResize("shrink") end)
                   -------------------------------- Monitor Movement --------------------------------
                   cmodal:bind('', 'left', 'Move to Left Monitor', function() s:moveToScreen("left") end)
                   cmodal:bind('', 'right', 'Move to Right Monitor', function() s:moveToScreen("right") end)
                   cmodal:bind('', 'up', 'Move to Above Monitor', function() s:moveToScreen("up") end)
                   cmodal:bind('', 'down', 'Move to Below Monitor', function() s:moveToScreen("down") end)
                   cmodal:bind('', 'space', 'Move to Next Monitor', function() s:moveToScreen("next") end)
                   -------------------------------- Re&Undo --------------------------------
                   cmodal:bind('', '[', 'Undo Window Manipulation', function() s:undo() end)
                   cmodal:bind('', ']', 'Redo Window Manipulation', function() s:redo() end)
                   cmodal:bind('', '`', 'Center Cursor', function() s:centerCursor() end)
                 end
})
#+end_src

** WindowHalfsAndThirds

#+begin_src lua
Install:andUse("WindowHalfsAndThirds",
               {
                 config = {
                   use_frame_correctness = true
                 },
                 -- hotkeys = 'default',
                 fn = function (s)
                   --- 1/3 ---
                   cmodal:bind('cmd', 'H', 'Left Screen/3', function() s:thirdLeft() end)
                   cmodal:bind('cmd', 'L', 'Right Screen/3', function() s:thirdRight() end)
                   cmodal:bind('cmd', 'J', 'Top Screen/3', function() s:thirdUp() end)
                   cmodal:bind('cmd', 'K', 'Bottom Screen/3', function() s:thirdDown() end)
                 end
               }
)
#+end_src
** [[http://www.hammerspoon.org/Spoons/WindowGrid.html][WindowGrid]] 网格布局

The [[http://www.hammerspoon.org/Spoons/WindowGrid.html][WindowGrid]] spoon sets up a key binding (=Hyper-g= here) to overlay a grid that
allows resizing windows by specifying their opposite corners.

~cmd + alt + ctrl + g~

#+begin_src lua
myGrid = { w = 4, h = 4 }
Install:andUse("WindowGrid",
               {
                 config = { gridGeometries =
                              { { myGrid.w .."x" .. myGrid.h } } },
                 hotkeys = {show_grid = {hyper, "g"}},
                 start = true
               }
)
#+end_src
** [[http://www.hammerspoon.org/Spoons/ToggleScreenRotation.html][ToggleScreenRotation]] 旋转屏幕

The [[http://www.hammerspoon.org/Spoons/ToggleScreenRotation.html][ToggleScreenRotation]] spoon sets up a key binding to rotate the external
screen (the spoon can set up keys for multiple screens if needed, but by default
it rotates the first external screen).

~ctrl + alt + cmd + <f12>~

#+begin_src lua
Install:andUse("ToggleScreenRotation",
               {
                 hotkeys = { first = {hyper, "f12"} }
               }
)
#+end_src
** end

#+begin_src lua
-- Register resizeM with modal supervisor
hsresizeM_keys = hsresizeM_keys or {"ctrl", "f12"}
if string.len(hsresizeM_keys[2]) > 0 then
  spoon.ModalMgr.supervisor:bind(hsresizeM_keys[1], hsresizeM_keys[2], "Enter resizeM Environment", function()
                                   -- Deactivate some modal environments or not before activating a new one
                                   spoon.ModalMgr:deactivateAll()
                                   -- Show an status indicator so we know we're in some modal environment now
                                   spoon.ModalMgr:activate({"resizeM"}, "#B22222")
  end)
end

----------------------------------------------------------------------------------------------------
-- Finally we initialize ModalMgr supervisor
spoon.ModalMgr.supervisor:enter()
#+end_src
* end
#+begin_src lua
hs.notify.new({title='Hammerspoon', informativeText='Ready to rock 🤘'}):send()
#+end_src
